<UserControl
  x:Class="RealQuery.Views.UserControls.PipelineCanvas"
  xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
  xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
  xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
  xmlns:hc="https://handyorg.github.io/handycontrol"
  xmlns:iconPacks="http://metro.mahapps.com/winfx/xaml/iconpacks"
  xmlns:local="clr-namespace:RealQuery.Views.UserControls"
  xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
  d:DesignHeight="450"
  d:DesignWidth="800"
  mc:Ignorable="d">

  <Grid>
    <Grid.RowDefinitions>
      <RowDefinition Height="Auto" />
      <!--  Header  -->
      <RowDefinition Height="*" />
      <!--  Steps List  -->
    </Grid.RowDefinitions>

    <!--  Header  -->
    <Border
      Grid.Row="0"
      Padding="12"
      Background="{DynamicResource SecondaryRegionBrush}"
      BorderBrush="{DynamicResource BorderBrush}"
      BorderThickness="0,0,0,1">

      <Grid>
        <Grid.ColumnDefinitions>
          <ColumnDefinition Width="*" />
          <ColumnDefinition Width="Auto" />
        </Grid.ColumnDefinitions>

        <StackPanel Grid.Column="0" Orientation="Horizontal">
          <iconPacks:PackIconPhosphorIcons
            Width="20"
            Height="20"
            Margin="0,0,8,0"
            VerticalAlignment="Center"
            Kind="FlowArrowBold" />
          <TextBlock
            VerticalAlignment="Center"
            FontSize="14"
            FontWeight="SemiBold"
            Text="Transformation Pipeline" />
          <TextBlock
            Margin="10,0,0,0"
            VerticalAlignment="Center"
            FontSize="12"
            Foreground="{DynamicResource SecondaryTextBrush}">
            <Run Text="{Binding TransformationSteps.Count, Mode=OneWay}" />
            <Run Text="steps" />
          </TextBlock>
        </StackPanel>

        <Button
          Grid.Column="1"
          Command="{Binding ClearStepsCommand}"
          Style="{StaticResource IconButton}">
          <hc:UniformSpacingPanel Spacing="4">
            <iconPacks:PackIconPhosphorIcons Kind="TrashBold" />
            <TextBlock Text="Clear All" />
          </hc:UniformSpacingPanel>
        </Button>
      </Grid>
    </Border>

    <!--  Steps List  -->
    <ScrollViewer
      Grid.Row="1"
      Padding="8"
      HorizontalScrollBarVisibility="Disabled"
      VerticalScrollBarVisibility="Auto">

      <ItemsControl ItemsSource="{Binding TransformationSteps}">
        <ItemsControl.ItemTemplate>
          <DataTemplate>
            <local:TransformationCard DeleteRequested="TransformationCard_DeleteRequested" StepClicked="TransformationCard_StepClicked" />
          </DataTemplate>
        </ItemsControl.ItemTemplate>
      </ItemsControl>
    </ScrollViewer>

    <!--  Empty State  -->
    <StackPanel
      Grid.Row="1"
      HorizontalAlignment="Center"
      VerticalAlignment="Center"
      Visibility="{Binding TransformationSteps.Count, Converter={StaticResource Int2VisibilityReConverter}}">

      <iconPacks:PackIconPhosphorIcons
        Width="64"
        Height="64"
        HorizontalAlignment="Center"
        Foreground="{DynamicResource SecondaryTextBrush}"
        Kind="FlowArrowLight"
        Opacity="0.3" />

      <TextBlock
        Margin="0,16,0,0"
        HorizontalAlignment="Center"
        FontSize="14"
        Foreground="{DynamicResource SecondaryTextBrush}"
        Text="No transformation steps yet" />

      <TextBlock
        Margin="0,4,0,0"
        HorizontalAlignment="Center"
        FontSize="12"
        Foreground="{DynamicResource ThirdTextBrush}"
        Text="Load data and add transformations to build your pipeline" />
    </StackPanel>
  </Grid>
</UserControl>
