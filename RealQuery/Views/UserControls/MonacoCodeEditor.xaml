<UserControl
  x:Class="RealQuery.Views.UserControls.MonacoCodeEditor"
  xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
  xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
  xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
  xmlns:hc="https://handyorg.github.io/handycontrol"
  xmlns:iconPacks="http://metro.mahapps.com/winfx/xaml/iconpacks"
  xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
  xmlns:wv2="clr-namespace:Microsoft.Web.WebView2.Wpf;assembly=Microsoft.Web.WebView2.Wpf"
  d:DesignHeight="450"
  d:DesignWidth="800"
  mc:Ignorable="d">
  <Grid>
    <Grid.RowDefinitions>
      <RowDefinition Height="Auto" />
      <RowDefinition Height="*" />
      <RowDefinition Height="Auto" />
    </Grid.RowDefinitions>

    <!--  Toolbar  -->
    <Border
      Grid.Row="0"
      Padding="10,8"
      Background="{DynamicResource SecondaryRegionBrush}"
      BorderBrush="{DynamicResource BorderBrush}"
      BorderThickness="0,0,0,1">

      <hc:UniformSpacingPanel Orientation="Horizontal" Spacing="10">

        <Separator />

        <Button
          x:Name="ExecuteButton"
          Style="{StaticResource ButtonDefault}"
          ToolTip="Execute code (F5)">
          <hc:UniformSpacingPanel Spacing="4">
            <iconPacks:PackIconPhosphorIcons Kind="PlayFill" />
            <TextBlock Text="Execute" />
          </hc:UniformSpacingPanel>
        </Button>

        <Button
          x:Name="ValidateButton"
          Style="{StaticResource ButtonDefault}"
          ToolTip="Validate syntax (F7)">
          <hc:UniformSpacingPanel Spacing="4">
            <iconPacks:PackIconPhosphorIcons Kind="CheckBold" />
            <TextBlock Text="Validate" />
          </hc:UniformSpacingPanel>
        </Button>

        <Button
          x:Name="FormatButton"
          Style="{StaticResource ButtonDefault}"
          ToolTip="Format code (Shift+Alt+F)">
          <hc:UniformSpacingPanel Spacing="4">
            <iconPacks:PackIconPhosphorIcons Kind="TextAlignLeft" />
            <TextBlock Text="Format" />
          </hc:UniformSpacingPanel>
        </Button>

        <Button
          x:Name="TemplatesButton"
          Style="{StaticResource ButtonDefault}"
          ToolTip="Insert code template">
          <Button.Content>
            <hc:UniformSpacingPanel Spacing="4">
              <iconPacks:PackIconPhosphorIcons Kind="ClipboardTextBold" />
              <TextBlock Text="Templates" />
            </hc:UniformSpacingPanel>
          </Button.Content>
          <Button.ContextMenu>
            <ContextMenu x:Name="TemplatesMenu">
              <MenuItem x:Name="FilterTemplate" Header="Filter Rows">
                <MenuItem.Icon>
                  <iconPacks:PackIconPhosphorIcons Kind="FunnelSimpleBold" />
                </MenuItem.Icon>
              </MenuItem>
              <MenuItem x:Name="SortTemplate" Header="Sort Data">
                <MenuItem.Icon>
                  <iconPacks:PackIconPhosphorIcons Kind="SortAscendingBold" />
                </MenuItem.Icon>
              </MenuItem>
              <MenuItem x:Name="AddColumnTemplate" Header="Add Column">
                <MenuItem.Icon>
                  <iconPacks:PackIconPhosphorIcons Kind="PlusBold" />
                </MenuItem.Icon>
              </MenuItem>
              <MenuItem x:Name="GroupTemplate" Header="Group &amp; Aggregate">
                <MenuItem.Icon>
                  <iconPacks:PackIconPhosphorIcons Kind="ChartBarFill" />
                </MenuItem.Icon>
              </MenuItem>
              <MenuItem x:Name="RemoveDuplicatesTemplate" Header="Remove Duplicates">
                <MenuItem.Icon>
                  <iconPacks:PackIconPhosphorIcons Kind="TrashBold" />
                </MenuItem.Icon>
              </MenuItem>
              <MenuItem x:Name="ConvertTypesTemplate" Header="Convert Types">
                <MenuItem.Icon>
                  <iconPacks:PackIconPhosphorIcons Kind="ArrowsClockwiseBold" />
                </MenuItem.Icon>
              </MenuItem>
            </ContextMenu>
          </Button.ContextMenu>
        </Button>

        <Separator />

        <!--  Theme Toggle  -->
        <Button
          x:Name="ThemeToggleButton"
          Style="{StaticResource IconButton}"
          ToolTip="Toggle theme">
          <iconPacks:PackIconPhosphorIcons Kind="MoonFill" />
        </Button>

        <!--  Status indicator  -->
        <StackPanel Orientation="Horizontal">
          <Ellipse
            x:Name="StatusIndicator"
            Width="8"
            Height="8"
            Margin="0,0,5,0"
            VerticalAlignment="Center"
            Fill="{DynamicResource SuccessBrush}" />
          <TextBlock
            x:Name="StatusText"
            VerticalAlignment="Center"
            FontSize="11"
            Text="⏳ Loading Monaco..." />
        </StackPanel>
      </hc:UniformSpacingPanel>
    </Border>

    <!--  Monaco Editor via WebView2  -->
    <Border
      Grid.Row="1"
      BorderBrush="{DynamicResource BorderBrush}"
      BorderThickness="1,0,1,0">

      <wv2:WebView2 x:Name="MonacoWebView" />

    </Border>

    <!--  Error/Status Bar  -->
    <Border
      x:Name="ErrorPanel"
      Grid.Row="2"
      Padding="10,8"
      Background="{DynamicResource DangerBrush}"
      BorderBrush="{DynamicResource BorderBrush}"
      BorderThickness="1,1,1,0"
      Visibility="Collapsed">

      <ScrollViewer MaxHeight="100" VerticalScrollBarVisibility="Auto">
        <StackPanel>
          <TextBlock
            FontWeight="Bold"
            Foreground="White"
            Text="⚠️ Code Validation Errors:" />
          <TextBlock
            x:Name="ErrorText"
            Margin="0,4,0,0"
            FontSize="11"
            Foreground="White"
            TextWrapping="Wrap" />
        </StackPanel>
      </ScrollViewer>
    </Border>
  </Grid>
</UserControl>
